(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{5818:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(7876),l=s(4232);let n="speechSynthesis"in window;function a(){var e;let[t,s]=(0,l.useState)([]),[a,i]=(0,l.useState)(!1),[c,o]=(0,l.useState)(!1),[m,x]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)(0),w=(0,l.useRef)(null),g=(0,l.useRef)(null),f=(0,l.useRef)(null);(0,l.useEffect)(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[t]);let b=(0,l.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.trim())return;let r=Date.now();if(r-p<2e3)return void alert("Подождите немного перед следующим запросом");h(r),w.current&&(w.current.abort(),w.current=null);let l={role:"user",text:e,timestamp:new Date().toISOString(),isVoiceInput:t};s(e=>[...e,l]),o(!0),s(e=>e.filter(e=>!("assistant"===e.role&&e.text.includes("Ошибка"))));let n=new AbortController;w.current=n;try{let t=await fetch("/api/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:e,systemPrompt:"Ты — голосовой ассистент для колориста. Отвечай кратко, по существу."}),signal:n.signal,timeout:3e4});if(!t.ok){let e=await t.text();throw Error("Сервер вернул ".concat(t.status,": ").concat(e))}let r=await t.json(),l={role:"assistant",text:r.reply||"Нет ответа",timestamp:new Date().toISOString()};s(e=>[...e,l])}catch(r){var a,i,c;let e="Ошибка соединения. Попробуйте позже.";"AbortError"===r.name&&(e="Запрос отменён."),(null==(a=r.message)?void 0:a.includes("429"))&&(e="Слишком много запросов. Подождите минуту."),(null==(i=r.message)?void 0:i.includes("timeout"))&&(e="Таймаут запроса. Попробуйте ещё раз."),(null==(c=r.message)?void 0:c.includes("500"))&&(e="Сервер перегружен. Подождите минуту.");let t={role:"assistant",text:e,timestamp:new Date().toISOString()};s(e=>[...e,t]),console.error("[VoiceAssistant] Fetch error:",r)}finally{o(!1),w.current=null}},[p]);(0,l.useEffect)(()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return;let t=new e;t.lang="ru-RU",t.interimResults=!0,t.continuous=!1,t.onresult=e=>{let t="",s="";for(let r=e.resultIndex;r<e.results.length;r++){let l=e.results[r][0].transcript;e.results[r].isFinal?t=l:s+=l}x(t||s),t.trim()&&setTimeout(()=>{b(t,!0),x("")},500)},t.onerror=()=>i(!1),t.onend=()=>i(!1),g.current=t},[b]),(0,l.useEffect)(()=>{let e=()=>u(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let y=d?"max-w-[85%] text-sm":"max-w-[75%]";return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-2 sm:p-4",children:[(0,r.jsxs)("div",{className:"mb-4 sm:mb-6 text-center",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"\uD83C\uDFA4 Голосовой ассистент"}),(0,r.jsx)("p",{className:"text-sm sm:text-base text-gray-600",children:"Работайте руками в салоне - общайтесь голосом"})]}),(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[(0,r.jsx)("button",{onClick:()=>{g.current&&(a?g.current.stop():(x(""),g.current.start(),i(!0)))},disabled:c,className:"relative ".concat(d?"w-20 h-20 text-3xl":"w-24 h-24 text-4xl"," rounded-full flex items-center justify-center transition-all\n            ").concat(a?"bg-red-500 animate-pulse-record":"bg-gradient-to-r from-purple-500 to-pink-500 hover:scale-105","\n            ").concat(c?"opacity-50 cursor-not-allowed":""),children:(0,r.jsx)("span",{className:d?"text-3xl":"text-4xl",children:a?"⏹️":"\uD83C\uDFA4"})}),(0,r.jsxs)("div",{className:"text-center px-4",children:[(0,r.jsx)("p",{className:"font-semibold ".concat(a?"text-red-500":"text-gray-700"," text-base sm:text-lg"),children:a?"Слушаю... Говорите!":"Нажмите и говорите"}),m&&(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1 break-words",children:['Распознано: "',m,'"']})]}),(0,r.jsxs)("div",{className:"flex gap-2 sm:gap-3 mt-3 sm:mt-4 w-full justify-center",children:[n&&(null==(e=window.speechSynthesis)?void 0:e.speaking)&&(0,r.jsx)("button",{onClick:()=>{window.speechSynthesis&&window.speechSynthesis.cancel(),w.current&&(w.current.abort(),w.current=null),o(!1)},className:"flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-medium",children:"⏸️ Стоп"}),(0,r.jsx)("button",{onClick:()=>{confirm("Очистить историю?")&&s([])},className:"flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg text-sm font-medium",children:"\uD83D\uDDD1️ Очистить"})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-4 sm:p-6",children:[(0,r.jsx)("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"История"}),(0,r.jsxs)("div",{className:"h-64 sm:h-96 overflow-y-auto space-y-2 sm:space-y-3 pr-2",children:[0===t.length?(0,r.jsxs)("div",{className:"text-center py-8 sm:py-12 text-gray-400",children:[(0,r.jsx)("div",{className:"text-5xl sm:text-6xl mb-3 sm:mb-4",children:"\uD83D\uDC87‍♀️"}),(0,r.jsx)("p",{className:"text-sm sm:text-base",children:"Начните голосовой диалог с AI"}),(0,r.jsx)("p",{className:"text-xs sm:text-sm mt-1 sm:mt-2",children:'Спросите: "Какой окислитель на корни?"'})]}):t.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3 ".concat("user"===e.role?"flex-row-reverse":""),children:[(0,r.jsx)("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm flex-shrink-0 ".concat("user"===e.role?"bg-blue-500 text-white":"bg-purple-500 text-white"),children:"user"===e.role?e.isVoiceInput?"\uD83C\uDFA4":"\uD83D\uDC64":"\uD83E\uDD16"}),(0,r.jsxs)("div",{className:"".concat(y," rounded-2xl px-3 sm:px-4 py-2 ").concat("user"===e.role?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:[(0,r.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed ".concat(d?"text-sm":""),children:e.text}),(0,r.jsx)("p",{className:"text-xs mt-1 ".concat("user"===e.role?"text-blue-100":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),"assistant"===e.role&&n&&(0,r.jsx)("button",{onClick:()=>(e=>{if(!("speechSynthesis"in window))return;window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.lang="ru-RU",t.rate=.9,window.speechSynthesis.speak(t)})(e.text),className:"mt-2 text-xs text-purple-600 hover:text-purple-700 font-medium",children:"\uD83D\uDD0A Прослушать"})]})]},t)),c&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-gray-100 rounded-2xl px-4 py-3",children:(0,r.jsx)("span",{className:"animate-pulse text-sm",children:"\uD83E\uDD16 Думаю..."})})}),(0,r.jsx)("div",{ref:f})]})]}),(0,r.jsxs)("div",{className:"mt-4 sm:mt-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-3 sm:p-4",children:[(0,r.jsx)("h3",{className:"font-bold text-purple-900 mb-2 text-sm sm:text-base",children:"\uD83D\uDCA1 Что можно спросить:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1 sm:gap-2",children:["Какой окислитель на корни?","Что делать с жёлтым оттенком?","Как смешать 7,5 % окислитель?","Сколько выдерживать на пористых волосах?"].map((e,t)=>(0,r.jsx)("button",{onClick:()=>b(e),disabled:c,className:"px-2 sm:px-3 py-1 bg-white border border-purple-200 rounded-full text-xs sm:text-sm hover:bg-purple-100 disabled:opacity-50",children:e},t))})]})]})}},8425:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/Assistant",function(){return s(5818)}])}},e=>{e.O(0,[636,593,792],()=>e(e.s=8425)),_N_E=e.O()}]);