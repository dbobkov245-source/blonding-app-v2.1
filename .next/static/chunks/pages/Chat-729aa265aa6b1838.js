(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[946],{5024:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/Chat",function(){return s(8215)}])},8215:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var l=s(7876),r=s(4232);function a(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(""),[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(null),[u,m]=(0,r.useState)(0),h=(0,r.useRef)(null),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[e]);let p=async()=>{c({title:"Подготовка к блондированию",content:"Важные правила перед блондированием: 1. Мыть волосы за сутки до процедуры 2. Обязательно делать тестовую прядь 3. Проверять эластичность волос 4. Смешивать продукт маленькими порциями"})};(0,r.useEffect)(()=>{p()},[]);let b=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,l=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e.trim()&&!d)return;let r=Date.now();if(r-u<2e3)return void alert("Подождите немного перед следующим запросом");m(r);let n=e;l&&o&&(n='Контекст урока "'.concat(o.title,'":\n').concat(o.content,"\n\nВопрос студента: ").concat(e)),d&&(n+="\n\n[Пользователь прикрепил изображение для анализа]");let c={role:"user",text:e,image:d,timestamp:new Date().toISOString()};t(e=>[...e,c]),a(""),x(null),i(!0);try{let e=await fetch("/api/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:n,image:d})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json(),l={role:"assistant",text:s.reply||s.error||"Нет ответа",timestamp:new Date().toISOString()};t(e=>[...e,l])}catch(s){let e={role:"assistant",text:"Ошибка при запросе к AI. Проверьте подключение или попробуйте позже.",timestamp:new Date().toISOString()};t(t=>[...t,e])}finally{i(!1)}},f=e=>{a(e),b(e)};return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"AI-консультант"}),o&&(0,l.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Контекст: ",o.title]})]}),(0,l.jsx)("button",{onClick:()=>{window.confirm("Очистить историю чата?")&&t([])},className:"text-sm text-red-600 hover:text-red-800 px-3 py-1 border border-red-300 rounded-md",children:"Очистить историю"})]}),0===e.length&&(0,l.jsxs)("div",{className:"mb-4 bg-blue-50 p-4 rounded-lg",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Быстрые вопросы:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:[{emoji:"\uD83D\uDCA1",text:"Объясни проще"},{emoji:"\uD83D\uDCD6",text:"Приведи пример"},{emoji:"❓",text:"Что это значит?"},{emoji:"‼",text:"Какие ошибки можно допустить?"},{emoji:"➡",text:"Дай пошаговую инструкцию"},{emoji:"\uD83D\uDD0D",text:"Расскажи подробнее"}].map((e,t)=>(0,l.jsxs)("button",{onClick:()=>f(e.text),className:"px-3 py-1.5 bg-white border border-blue-200 rounded-full text-sm hover:bg-blue-100 transition-colors",children:[e.emoji," ",e.text]},t))})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,l.jsxs)("div",{className:"h-[500px] overflow-auto p-4 space-y-4",children:[0===e.length?(0,l.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83E\uDD16"}),(0,l.jsx)("p",{className:"text-lg",children:"Задайте вопрос по уроку"}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"Я помогу разобраться в материале"})]}):e.map((e,t)=>(0,l.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,l.jsxs)("div",{className:"flex items-start gap-3 max-w-[75%] ".concat("user"===e.role?"flex-row-reverse":""),children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-2xl flex-shrink-0 ".concat("user"===e.role?"bg-blue-500 text-white":"bg-gradient-to-br from-purple-500 to-pink-500 text-white"),children:"user"===e.role?"\uD83D\uDC64":"\uD83E\uDD16"}),(0,l.jsxs)("div",{className:"rounded-2xl px-4 py-3 ".concat("user"===e.role?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:[e.image&&(0,l.jsx)("img",{src:e.image,alt:"Uploaded",className:"max-w-xs rounded-lg mb-2"}),(0,l.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.text}),(0,l.jsx)("p",{className:"text-xs mt-2 ".concat("user"===e.role?"text-blue-100":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})})]})]})},t)),(0,l.jsx)("div",{ref:h})]}),(0,l.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[d&&(0,l.jsxs)("div",{className:"mb-3 relative inline-block",children:[(0,l.jsx)("img",{src:d,alt:"Preview",className:"h-20 rounded-lg border-2 border-blue-400"}),(0,l.jsx)("button",{onClick:()=>{x(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold hover:bg-red-600",children:"\xd7"})]}),e.length>0&&"assistant"===e[e.length-1].role&&(0,l.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>f("Объясни проще"),className:"text-xs px-3 py-1 bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200",children:"Объясни проще"}),(0,l.jsx)("button",{onClick:()=>f("Приведи пример"),className:"text-xs px-3 py-1 bg-green-100 text-green-700 rounded-full hover:bg-green-200",children:"Приведи пример"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>{var e;return null==(e=g.current)?void 0:e.click()},className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",title:"Прикрепить изображение",children:"\uD83D\uDCCE"}),(0,l.jsx)("input",{ref:g,type:"file",accept:"image/*",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){if(s.size>2097152)return void alert("Файл слишком большой. Максимум 2MB.");let e=new FileReader;e.onload=e=>{var t;x(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(s)}},className:"hidden"}),(0,l.jsx)("textarea",{value:s,onChange:e=>a(e.target.value),className:"flex-1 p-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Задайте вопрос... (Shift+Enter для новой строки)",rows:2,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),n||b())}}),(0,l.jsx)("button",{onClick:()=>b(),disabled:n||!s.trim()&&!d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:n?(0,l.jsxs)("span",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"animate-spin",children:"⏳"})," Думаю..."]}):"Отправить"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Совет: Вопросы автоматически учитывают контекст текущего урока"})]})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=5024)),_N_E=e.O()}]);