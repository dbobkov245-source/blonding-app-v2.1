/**
 * Централизованная функция для вызовов Hugging Face API.
 */
export async function callHF(inputs, { hfToken, model, maxTokens, temperature }) {
  if (!hfToken) {
    throw new Error("callHF: HF_TOKEN (hfToken) is missing");
  }

  const url = "https://router.huggingface.co/vl/chat/completions";

  // Промпт 'inputs' от generate-quizzes.js уже содержит все инструкции.
  // Поэтому мы просто передаем его как есть.
  const body = {
    model: model || "meta-llama/Meta-Llama-3-8B-Instruct",
    messages: [
      { role: "user", content: inputs }
    ],
    max_tokens: maxTokens || 2048,
    temperature: temperature || 0.7,
  };

  const hfResponse = await fetch(url, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${hfToken}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  const data = await hfResponse.json();

  if (!hfResponse.ok) {
    console.error("HF API Error:", data);
    throw new Error(`Hugging Face API error: ${data.error || hfResponse.statusText}`);
  }

  const message = data.choices?.[0]?.message?.content || "";
  
  if (!message) {
     throw new Error("Hugging Face API returned an empty response.");
  }
  
  return message;
}
